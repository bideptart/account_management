{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>Search Results for "{{ query }}"</h2>
        <p>
            <a href="{% url 'files:file_list' %}{% if target_user != user %}?user_id={{ target_user.id }}{% endif %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Files
            </a>
        </p>
    </div>
</div>

<!-- Folders -->
<div class="row mb-4">
    <div class="col">
        <h3>Folders</h3>
        <div class="row">
            {% for folder in folders %}
                <div class="col-md-3 mb-4">
                    <div class="card folder-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-folder fs-1 text-warning"></i>
                            <h5 class="card-title mt-2">{{ folder.name }}</h5>
                            <p class="card-text"><small class="text-muted">Created: {{ folder.created_at|date:"F d, Y" }}</small></p>
                        </div>
                        <div class="card-footer d-flex justify-content-between">
                            <a href="{% url 'files:folder_detail' folder.id %}{% if target_user != user %}?user_id={{ target_user.id }}{% endif %}" class="btn btn-sm btn-primary">Open</a>
                            <a href="{% url 'files:delete_folder' folder.id %}{% if target_user != user %}?user_id={{ target_user.id }}{% endif %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this folder and all its contents?')">Delete</a>
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="col">
                    <div class="alert alert-info">No folders found matching "{{ query }}".</div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Files -->
<div class="row">
    <div class="col">
        <h3>Files</h3>
        <div class="row">
            {% for file in files %}
                <div class="col-md-3 mb-4">
                    <div class="card file-card h-100">
                        <div class="card-body text-center">
                            {% if file.is_image %}
                                <img src="{{ file.file.url }}" class="img-fluid mb-2" style="max-height: 100px;" alt="{{ file.name }}">
                            {% else %}
                                {% with ext=file.get_file_type %}
                                    {% if ext == '.pdf' %}
                                        <i class="bi bi-file-earmark-pdf file-icon text-danger"></i>
                                    {% elif ext == '.doc' or ext == '.docx' %}
                                        <i class="bi bi-file-earmark-word file-icon text-primary"></i>
                                    {% elif ext == '.xls' or ext == '.xlsx' %}
                                        <i class="bi bi-file-earmark-excel file-icon text-success"></i>
                                    {% elif ext == '.ppt' or ext == '.pptx' %}
                                        <i class="bi bi-file-earmark-ppt file-icon text-warning"></i>
                                    {% elif ext == '.zip' or ext == '.rar' %}
                                        <i class="bi bi-file-earmark-zip file-icon text-secondary"></i>
                                    {% elif ext == '.txt' %}
                                        <i class="bi bi-file-earmark-text file-icon text-info"></i>
                                    {% else %}
                                        <i class="bi bi-file-earmark file-icon"></i>
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                            <h5 class="card-title mt-2">{{ file.name }}</h5>
                            <p class="card-text"><small class="text-muted">Size: {{ file.size|filesizeformat }}</small></p>
                            <p class="card-text"><small class="text-muted">Uploaded: {{ file.created_at|date:"F d, Y" }}</small></p>
                        </div>
                        <div class="card-footer">
                            <div class="btn-group w-100">
                                <a href="{% url 'files:download_file' file.id %}" class="btn btn-sm btn-primary">Download</a>
                                <a href="{% url 'files:edit_file' file.id %}{% if target_user != user %}?user_id={{ target_user.id }}{% endif %}" class="btn btn-sm btn-secondary">Edit</a>
                                <a href="{% url 'files:delete_file' file.id %}{% if target_user != user %}?user_id={{ target_user.id }}{% endif %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this file?')">Delete</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="col">
                    <div class="alert alert-info">No files found matching "{{ query }}".</div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}