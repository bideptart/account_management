{% load static %}

<!-- Sidebar -->
<div class="w-64 bg-white border-r border-gray-200 flex flex-col h-full">
    <!-- User Profile Section -->
    <div class="p-6 border-b border-gray-200">
        <div class="flex items-center">
            <div class="w-12 h-12 bg-primary-600 rounded-full flex items-center justify-center text-white font-semibold text-lg">
                {{ user.username|first|upper }}
            </div>
            <div class="ml-3">
                <h3 class="font-semibold text-gray-900">{{ user.username }}</h3>
                <p class="text-sm text-gray-500">{{ user.email }}</p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 p-4">
        <div class="space-y-2">
            <!-- Dashboard Link -->
            <a href="{% url 'files:file_list' %}" 
               class="flex items-center px-3 py-2 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'file_list' and not request.GET.folder_id %}bg-primary-100 text-primary-700{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors">
                <i class="fas fa-home mr-3"></i>
                My Files
            </a>
            
            <!-- Recent Files -->
            <a href="{% url 'files:recent_files' %}" 
               class="flex items-center px-3 py-2 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'recent_files' %}bg-primary-100 text-primary-700{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors">
                <i class="fas fa-clock mr-3"></i>
                Recent
            </a>
            
            <!-- Shared Files -->
            <a href="{% url 'files:shared_files' %}" 
               class="flex items-center px-3 py-2 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'shared_files' %}bg-primary-100 text-primary-700{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors">
                <i class="fas fa-share-alt mr-3"></i>
                Shared
            </a>
            
            <!-- Trash -->
            <a href="{% url 'files:trash_files' %}" 
               class="flex items-center px-3 py-2 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'trash_files' %}bg-primary-100 text-primary-700{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors">
                <i class="fas fa-trash mr-3"></i>
                Trash
            </a>
        </div>
        
        <!-- Divider -->
        <div class="border-t border-gray-200 my-4"></div>
        
        <!-- Folders Section -->
        <div>
            <div class="flex items-center justify-between mb-3">
                <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Folders</h4>
                <button onclick="openCreateFolderModal()" 
                        class="text-primary-600 hover:text-primary-700 transition-colors" 
                        title="Create Folder">
                    <i class="fas fa-plus text-sm"></i>
                </button>
            </div>
            
            <!-- Folder List -->
            <div class="space-y-1" id="folderList">
                {% for folder in user_folders %}
                    <a href="{% url 'files:file_list' %}?folder_id={{ folder.id }}" 
                       class="flex items-center px-3 py-2 text-sm rounded-lg {% if request.GET.folder_id == folder.id|stringformat:'s' %}bg-primary-100 text-primary-700{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors group">
                        <i class="fas fa-folder mr-3 text-yellow-500"></i>
                        <span class="flex-1 truncate">{{ folder.name }}</span>
                        <span class="text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">
                            {{ folder.file_count|default:0 }}
                        </span>
                    </a>
                {% empty %}
                    <div class="text-center py-4">
                        <i class="fas fa-folder-open text-2xl text-gray-300 mb-2"></i>
                        <p class="text-xs text-gray-500">No folders yet</p>
                        <button onclick="openCreateFolderModal()" 
                                class="text-xs text-primary-600 hover:text-primary-700 mt-1">
                            Create your first folder
                        </button>
                    </div>
                {% endfor %}
            </div>
        </div>
    </nav>
     
     <!-- Storage Info -->
<!-- Storage Info -->
<div class="p-4 border-t border-gray-200">
    <div class="bg-gray-50 rounded-lg p-3">
        <div class="flex items-center justify-between mb-2">
            <span class="text-xs font-medium text-gray-700">Storage Used</span>
            <span class="text-xs text-gray-500">{{ used_storage|filesizeformat }} / 400 MB</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            {% widthratio used_storage 400000000 100 as storage_percentage %}
            <div class="bg-primary-600 h-2 rounded-full" style="width: {{ storage_percentage }}%"></div>
        </div>
        {% if used_storage >= 320000000 %}
            <p class="text-xs text-orange-600 mt-1">
                <i class="fas fa-exclamation-triangle mr-1"></i>
                Storage almost full
            </p>
        {% endif %}
    </div>
</div>
     
     <!-- Quick Actions -->
    <div class="p-4 border-t border-gray-200">
        <button onclick="openUploadModal()" 
                class="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors mb-2">
            <i class="fas fa-upload mr-2"></i>Upload Files
        </button>
        <button onclick="openCreateFolderModal()" 
                class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
            <i class="fas fa-folder-plus mr-2"></i>New Folder
        </button>
    </div>
</div>

<script>
// Sidebar functionality
function openCreateFolderModal() {
    const modal = document.getElementById('createFolderModal');
    if (modal) {
        modal.classList.remove('hidden');
        const folderNameInput = document.getElementById('folderName') || document.querySelector('input[name="name"]');
        if (folderNameInput) {
            folderNameInput.focus();
        }
    }
}

function openUploadModal() {
    const modal = document.getElementById('uploadModal');
    if (modal) {
        modal.classList.remove('hidden');
    }
}

// Update folder count dynamically
function updateFolderCount(folderId, count) {
    const folderLink = document.querySelector(`a[href*="folder_id=${folderId}"] .text-xs`);
    if (folderLink) {
        folderLink.textContent = count;
    }
}
</script>